#!/usr/bin/env ruby

puts "ğŸ” Pre-deploy checks..."

errors = []

# Check master key
unless File.exist?('config/master.key')
  errors << "âŒ Master key missing"
end

# Check database config
unless File.read('config/database.yml').include?('production:')
  errors << "âŒ Production database not configured"
end

# Check Gemfile
gemfile = File.read('Gemfile')
if gemfile.include?("gem 'sqlite3'") && !gemfile.include?('group :development')
  errors << "âš ï¸  SQLite in production"
end

# Check storage config
unless File.exist?('config/storage.yml')
  errors << "âŒ Storage config missing"
end

# Check build script
unless File.exist?('bin/render-build.sh')
  errors << "âŒ Build script missing"
end

# Check if script is executable
if File.exist?('bin/render-build.sh')
  unless File.executable?('bin/render-build.sh')
    errors << "âŒ Build script not executable"
  end
end

if errors.any?
  puts "\nâŒ Pre-deploy checks failed:"
  errors.each { |e| puts "  #{e}" }
  exit 1
else
  puts "âœ… All checks passed!"
end
